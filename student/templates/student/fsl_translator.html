{% load static %}
<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>FSL Kid Translator</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />

        <style>
            body {
                background-color: #e0f7fa;
                font-family: "Comic Neue", sans-serif;
            }
            .main-card {
                background: white;
                border-radius: 30px; /* Slightly rounder */
                box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15); /* Deeper shadow */
                border: 5px solid #4dd0e1;
            }
            .sign-container {
                min-height: 250px; /* Taller container */
                background-color: #f8f9fa;
                border-radius: 25px;
                border: 3px dashed #adb5bd;
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                align-items: center;
                gap: 20px; /* More space between cards */
                padding: 30px;
            }
            .fsl-card {
                text-align: center;
                animation: popIn 0.3s ease-out;
                margin-bottom: 10px;
            }

            /* --- THE BIG CHANGES ARE HERE --- */
            .fsl-img {
                width: 160px; /* Was 80px -> Now 160px */
                height: 160px; /* Was 80px -> Now 160px */
                object-fit: cover; /* Ensures video fills the square without stretching */
                border-radius: 15px;
                background: #000; /* Black background looks better for video */
                box-shadow: 0 8px 12px rgba(0, 0, 0, 0.2);
                border: 2px solid #fff; /* Crisp white border around the video */
            }

            .letter-label {
                font-size: 2rem; /* Was 1.2rem -> Now 2rem (Huge) */
                font-weight: 800;
                color: #0097a7;
                margin-top: 10px;
                text-transform: uppercase;
                letter-spacing: 2px;
            }
            /* -------------------------------- */

            @keyframes popIn {
                0% {
                    transform: scale(0);
                    opacity: 0;
                }
                80% {
                    transform: scale(1.1);
                }
                100% {
                    transform: scale(1);
                    opacity: 1;
                }
            }
        </style>
    </head>
    <body>
        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-md-10">
                    <div class="main-card p-5">
                        <h1 class="text-center mb-4 text-info fw-bold">
                            üñêÔ∏è FSL Text-to-Fingerspelling
                        </h1>

                        <div class="mb-4">
                            <label
                                for="textInput"
                                class="form-label h4 text-secondary"
                                >Type a word below:</label
                            >

                            <div class="input-group">
                                <input
                                    type="text"
                                    class="form-control form-control-lg rounded-start-pill p-3 border-info shadow-sm"
                                    id="textInput"
                                    placeholder="Type here (e.g., 'NI√ëO')..."
                                    autocomplete="off"
                                />

                                <button
                                    class="btn btn-info text-white fw-bold rounded-end-pill px-4"
                                    type="button"
                                    onclick="insertEnye()"
                                >
                                    + √±
                                </button>
                            </div>
                            <div class="form-text text-muted ps-3">
                                Click "+ √±" to insert the special character.
                            </div>
                        </div>

                        <div id="signDisplay" class="sign-container">
                            <p class="text-muted fs-4">
                                Signs will appear here!
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // 1. Load the data passed from Django (CRITICAL)
            // If you deleted this line before, that is why it broke.
            const signMap = {{ sign_map|safe }};

            const inputField = document.getElementById('textInput');
            const displayArea = document.getElementById('signDisplay');

            // 2. The Smart Typing Logic (Handles Ng and Video)
            inputField.addEventListener('input', function(e) {
                const text = e.target.value.toLowerCase();
                displayArea.innerHTML = ''; // Clear current signs

                if (text.length === 0) {
                    displayArea.innerHTML = '<p class="text-muted fs-4">Signs will appear here!</p>';
                    return;
                }

                // Loop through each letter
                for (let i = 0; i < text.length; i++) {
                    let char = text[i];
                    let nextChar = text[i+1]; // Peek at the next letter
                    let keyToUse = char;

                    // --- LOGIC FOR "NG" ---
                    // If current char is 'n' AND next char is 'g', treat as 'ng'
                    if (char === 'n' && nextChar === 'g') {
                        // Check if we actually have an 'ng' clip in the DB
                        if (signMap['ng']) {
                            keyToUse = 'ng';
                            i++; // SKIP the next letter (the 'g') so it doesn't print twice
                        }
                    }

                    // Check if we have a sign for this key
                    if (signMap[keyToUse]) {
                        const wrapper = document.createElement('div');
                        wrapper.className = 'fsl-card';

                        const video = document.createElement('video');
                        video.src = signMap[keyToUse];
                        video.className = 'fsl-img';
                        video.autoplay = true;
                        video.loop = true;
                        video.muted = true; // Required for Chrome autoplay
                        video.playsInline = true;

                        const label = document.createElement('div');
                        label.innerText = keyToUse.toUpperCase();
                        label.className = 'letter-label';

                        wrapper.appendChild(video);
                        wrapper.appendChild(label);
                        displayArea.appendChild(wrapper);
                    }
                    else if (char === ' ') {
                        const spacer = document.createElement('div');
                        spacer.style.width = "80px"; // Wide gap for space
                        displayArea.appendChild(spacer);
                    }
                }
            });

            // 3. The Function for the "√ë" Button
            function insertEnye() {
                const input = document.getElementById('textInput');
                input.value += '√±';

                // Manually trigger the input event so the loop above runs
                const event = new Event('input', { bubbles: true });
                input.dispatchEvent(event);
                input.focus();
            }
        </script>
    </body>
</html>
